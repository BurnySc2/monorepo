<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HTMX+Fastapi Todo App</title>
    <script>
      // Summary:
      // Using oauth2 we get redirected back to this page with a 'code=...' parameter in the URL
      // Set this as cookies so that we can access it with the htmx request

      // Get the URL of the current page
      const currentUrl = window.location.href;
      // Create a URLSearchParams object
      const urlParams = new URLSearchParams(window.location.search);
      // Get the value of the "code" parameter
      const codeParam = urlParams.get("code");
      // Check if the "code" parameter exists and is not null
      if (codeParam !== null) {
        // Use the value of the "code" parameter
        console.log("Value of 'code' parameter:", codeParam);
        document.cookie = `code=${codeParam}; expires=30; path=/`;

        // Redirect after successful login
        window.location.href = "https://{{ server_url }}/chat";
      } else {
        // "code" parameter is not present in the URL
        console.log("'code' parameter is missing.");
      }
    </script>
  </head>

  <body>
    <h1>Logging in ...</h1>
  </body>
</html>
